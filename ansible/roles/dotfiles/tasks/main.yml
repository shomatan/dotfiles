---
- name: Check user directories
  stat:
    path: "{{ item }}"
  register: directory_stats
  with_items: "{{ dotfiles_directories|default([]) }}"

- name: Create multiple directories without disturbing previous permissions
  file:
    path: "{{ item.item }}"
    state: directory
  when: item.stat.exists == false
  with_items:
    - "{{ directory_stats.results }}"

- name: Symlink dotfiles
  file:
    src: "{{ item.path }}"
    dest: "{{ item.dest }}"
    state: link
    force: yes
  with_items: "{{ dotfiles|default([]) }}"
  when: item.path is defined and item.dest is defined and item != ''

# zplug
- name: Install zplug
  git:
    repo: https://github.com/zplug/zplug
    dest: ~/.local/share/zplug

# zsh
- name: Get shell list
  shell: cat /etc/shells
  register: etc_shells
  changed_when: false

- name: Add `/etc/shells`
  lineinfile:
    dest: /etc/shells
    line: "{{ item }}"
    state: present
    owner: root
    mode: 0644
  become: true
  when: etc_shells.stdout.find(item) == -1
  with_items:
    - /bin/zsh

- name: Change default shell
  shell: chsh -s /bin/zsh
  when: etc_shells.stdout.find('/bin/zsh') == -1

- name: Get git config
  shell: git config --list
  register: git_config
  changed_when: false

- name: Set global git config
  shell: git config --global {{ item.name }} {{ item.value }}
  when: git_config.stdout.find(item.name) == -1
  with_items:
    - name: user.name
      value: Shoma Nishitateno
    - name: push.default
      value: current
