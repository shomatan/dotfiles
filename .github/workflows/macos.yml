name: macOS

on: push

jobs:
  test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@latest

      - name: Setup GraalVM
        uses: DeLaGuardo/setup-graalvm@5.0
        with:
          graalvm: '22.2.0'
          java: 'java11'
          arch: 'aarch64'

      - run: java -version

      - run: gu install native-image

      - run: brew install sbt

      - uses: actions/cache@v3
        with:
          path: |
            ~/.sbt/boot
            ~/.sbt/launchers
            ~/.ivy2/cache
            ~/.cache/coursier/v1
          key: scala-cache-${{ hashFiles('build.sbt') }}-${{ hashFiles('project/plugins.sbt') }}-${{ hashFiles('project/build.properties') }}

      - run: sbt nativeImage

      - uses: actions/upload-artifact@master
        with:
          name: artifact
          path: target/native-image